<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Room with Rotating, Fast-Moving, Bouncing Model</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            cursor: url('cursor1.png') 16 16, auto;
        }
        body.clicking {
            cursor: url('cursor2.png') 16 16, auto !important;
        }
        canvas { display: block; }
        .overlay {
            position: fixed;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 24px;
            padding: 10px;
            cursor: url('cursorhover.png') 16 16, auto;
        }
        #title { top: 10%; left: 50%; transform: translateX(-50%); }
        #ig { top: 10%; right: 10%; }
        #animation { top: 10%; left: 10%; }
        #art { bottom: 10%; left: 10%; }
        #contact { bottom: 10%; right: 10%; }
        .overlay a {
            color: white;
            text-decoration: none;
            cursor: url('cursorhover.png') 16 16, auto;
        }
    </style>
</head>
<body>
    <div id="title" class="overlay">maks rz</div>
    <div id="ig" class="overlay"><a href="https://instagram.com/your_instagram" target="_blank">ig</a></div>
    <div id="animation" class="overlay"><a href="animation.html" target="_blank">animation</a></div>
    <div id="art" class="overlay"><a href="art.html" target="_blank">art</a></div>
    <div id="contact" class="overlay"><a href="contact.html" target="_blank">contact</a></div>
    <script>
        let scene, camera, renderer, room, model;
        let isDragging = false;
        let targetPosition = new THREE.Vector3(0, -1.75, 0);
        const GRID_SIZE = 8;
        const STEP_SIZE = 1;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const dragStart = new THREE.Vector3();
        const dragOffset = new THREE.Vector3();
        let velocity = new THREE.Vector3();
        let angularVelocity = new THREE.Vector3();
        let lastMousePosition = new THREE.Vector2();
        let isFlying = false;
        const DAMPING = 0.99;
        const ANGULAR_DAMPING = 0.98;
        const BOUNCE = 0.8;
        const GRAVITY = -0.05;
        const GROUND_Y = -1.75;
        const FORCE_MULTIPLIER = 15;
        const ANGULAR_FORCE_MULTIPLIER = 0.1;

        // Add transition elements
        let transitionCircle, transitionPlane;
        let isTransitioning = false;

        function init() {
            // ... (keep existing init code)

            // Add transition elements
            const circleGeometry = new THREE.CircleGeometry(0.01, 32);
            const circleMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            transitionCircle = new THREE.Mesh(circleGeometry, circleMaterial);
            transitionCircle.visible = false;
            scene.add(transitionCircle);

            const planeGeometry = new THREE.PlaneGeometry(2, 2);
            const planeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000, transparent: true, opacity: 0 });
            transitionPlane = new THREE.Mesh(planeGeometry, planeMaterial);
            transitionPlane.position.z = -1;
            camera.add(transitionPlane);
            scene.add(camera);

            // ... (keep the rest of the init function)

            document.querySelectorAll('.overlay a').forEach(link => {
                link.addEventListener('click', handleLinkClick);
            });
        }

        function handleLinkClick(e) {
            e.preventDefault();
            if (isTransitioning) return;
            
            const href = this.getAttribute('href');
            const rect = this.getBoundingClientRect();
            const centerX = (rect.left + rect.width / 2) / window.innerWidth * 2 - 1;
            const centerY = -(rect.top + rect.height / 2) / window.innerHeight * 2 + 1;
            
            isTransitioning = true;
            transitionOut(centerX, centerY, href);
        }

        function transitionOut(x, y, href) {
            transitionCircle.position.set(x * 5, y * 2.5, -5);
            transitionCircle.visible = true;
            transitionCircle.scale.set(0.01, 0.01, 1);

            const duration = 300; // milliseconds
            const startTime = performance.now();

            function animate(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);

                transitionCircle.scale.set(progress * 100, progress * 100, 1);

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    transitionPlane.material.opacity = 1;
                    setTimeout(() => {
                        window.open(href, '_blank');
                        transitionIn();
                    }, 700);
                }
            }

            requestAnimationFrame(animate);
        }

        function transitionIn() {
            const duration = 500; // milliseconds
            const startTime = performance.now();

            function animate(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);

                transitionPlane.material.opacity = 1 - progress;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    transitionCircle.visible = false;
                    isTransitioning = false;
                }
            }

            requestAnimationFrame(animate);
        }

        // ... (keep all other existing functions)

        function animate() {
            requestAnimationFrame(animate);

            // ... (keep existing animate code)

            renderer.render(scene, camera);
        }

        // ... (keep window resize event listener)

        init();
    </script>
</body>
</html>
