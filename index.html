<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maks Rz – Rewritten Throwing Part with Box2D</title>
  <style>
    /* Global settings – white background, custom cursor */
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background-color: white;
      cursor: url('cursor1.png'), auto;
    }
    /* Ellipse mask – shows content only inside the ellipse */
    .mask {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100vw;
      height: 100vh;
      transform: translate(-50%, -50%);
      clip-path: ellipse(25% 25% at 50% 50%);
      overflow: hidden;
      z-index: 1;
    }
    /* Background with 1.png texture */
    .bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 200%;
      height: 200%;
      background-image: url('1.png');
      background-repeat: repeat;
      background-size: 100vw 100vh;
      background-position: 0 0;
    }
    /* Hover overlay – displays images on button hover */
    #hoverImage {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: contain;
      background-repeat: repeat;
      background-position: center;
      z-index: 2;
    }
    /* Character container (2.png) with animation */
    .character {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 3;
    }
    .character img {
      width: 150px;
      height: auto;
    }
    /* Bouncing character style */
    .bouncing {
      position: absolute;
      transition: none;
    }
    /* Navigation container at the top */
    .nav-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      font-family: "Apple Garamond", serif;
      text-align: center;
      padding: 10px 0;
    }
    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .nav-buttons a:not(:last-child)::after {
      content: ", ";
      font-size: 0.5em;
    }
    .nav-button {
      background: none;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      text-decoration: none;
      color: #000;
      font-size: 5em;
    }
    .nav-button:hover {
      text-decoration: underline;
    }
    .nav-dropdowns {
      max-width: 100%;
      text-align: center;
      margin-top: 5px;
      word-wrap: break-word;
      z-index: 1000;
      position: relative;
    }
    .enemies-list li {
      font-size: 2em;
    }
    /* Awards container – initially hidden */
    #awards-container {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      padding-top: 20vh;
      box-sizing: border-box;
      justify-content: space-between;
      padding: 0 50px;
    }
    .festival-column {
      width: 45%;
    }
    .festival {
      margin-bottom: 1em;
      font-size: 2em;
      white-space: nowrap;
    }
    /* Visitor name – bottom right corner */
    #visitorName {
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 1.5em;
      color: #000;
      z-index: 1001;
    }
    @media (max-width: 600px) {
      .nav-button {
        font-size: 3em;
      }
      .festival {
        font-size: 1.5em;
      }
      #visitorName {
        font-size: 1.2em;
      }
    }
  </style>
  <!-- Load Box2DWeb from CDN (based on Erin Catto’s work) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/box2dweb/2.1.a.3/Box2dWeb-2.1.a.3.min.js"></script>
</head>
<body>
  <!-- Navigation -->
  <div class="nav-container">
    <div class="nav-buttons">
      <a href="#" class="nav-button" id="maks-button">maks rz</a>
      <a href="https://vimeo.com/maksrz" class="nav-button" id="video-button" target="_blank">video</a>
      <a href="https://instagram.com/robocik.2" class="nav-button" id="art-button" target="_blank">art</a>
      <a href="https://instagram.com/robocik.2" class="nav-button" target="_blank">ig</a>
      <a href="mailto:maksrzontkowski@gmail.com" class="nav-button" id="contact-button">contact</a>
      <a href="#" class="nav-button" id="enemies-button">list of my enemies</a>
      <a href="#" class="nav-button" id="awards-button">awards and festivals</a>
    </div>
    <div class="nav-dropdowns">
      <ul class="enemies-list" id="enemies-list" style="display:none;">
        <li>1. damien</li>
      </ul>
    </div>
  </div>
  <!-- Awards container -->
  <div id="awards-container">
    <div class="festival-column left">
      <div class="festival">*Sundance Film Festival 2024 Official Selection*</div>
      <div class="festival">*ANNECY International Animation Festival 2024 Official Selection*</div>
      <div class="festival">*OTTAWA Animation Festival AWARD WINNER*</div>
      <div class="festival">*SPEKTRUM 2024 GRAND PRIZE*</div>
      <div class="festival">*New Horizons Festival 2024 Official Selection*</div>
      <div class="festival">*PICTOPLASMA 2024 Official Selection*</div>
      <div class="festival">*FEST New Directors 2024 Official Selection*</div>
      <div class="festival">*Rooftop Films 2024 Official Selection*</div>
    </div>
    <div class="festival-column right">
      <div class="festival">*Animator Festival 2024: AWARD WINNER*</div>
      <div class="festival">*SFP Best Animated Films 2023, AWARD WINNER*</div>
      <div class="festival">*Kaboom Animation Festival 2024: Special Mention*</div>
      <div class="festival">*ŻUBROFFKA 2024: AWARD WINNER*</div>
      <div class="festival">*Salute Your Shorts Festival 2024 Official Selection*</div>
      <div class="festival">*Fest Anca 2024 Official Selection*</div>
      <div class="festival">*HELSINKI INTERNATIONAL FILM FESTIVAL*</div>
      <div class="festival">*TOHORROR 2024 GRAND PRIZE*</div>
    </div>
  </div>
  <!-- Ellipse mask with background and hover overlay -->
  <div class="mask">
    <div class="bg" id="bg"></div>
    <div id="hoverImage"></div>
  </div>
  <!-- Character (2.png) with animation -->
  <div class="character" id="character">
    <img src="2.png" id="characterImg" alt="Character"
         draggable="false"
         ondragstart="return false;"
         oncontextmenu="return false;"
         style="-webkit-user-drag: none;">
  </div>
  <!-- Visitor name -->
  <div id="visitorName"></div>
  <script>
    // Prevent default drag behavior on character image
    const characterImg = document.getElementById('characterImg');
    characterImg.addEventListener('dragstart', e => e.preventDefault());
    characterImg.addEventListener('contextmenu', e => e.preventDefault());

    // Toggle enemies list
    document.getElementById('enemies-button').addEventListener('click', function(e) {
      e.preventDefault();
      const enemiesList = document.getElementById('enemies-list');
      enemiesList.style.display = (enemiesList.style.display === 'block') ? 'none' : 'block';
    });
    // Toggle awards container
    document.getElementById('awards-button').addEventListener('click', function(e) {
      e.preventDefault();
      const awardsContainer = document.getElementById('awards-container');
      awardsContainer.style.display = (awardsContainer.style.display === 'flex') ? 'none' : 'flex';
    });

    // Background animation (moves 1.png)
    let windowWidth = window.innerWidth;
    let windowHeight = window.innerHeight;
    const bg = document.getElementById('bg');
    let offsetX = 0, offsetY = 0;
    let speedX = 0, speedY = 0;
    let lastFrameTime = Date.now();
    let lastMouseTime = Date.now();
    
    function animateBackground() {
      const now = Date.now();
      const deltaTime = now - lastFrameTime;
      lastFrameTime = now;
      if (now - lastMouseTime > 500) {
        const decayFactor = Math.pow(0.5, deltaTime / 1000);
        speedX *= decayFactor;
        speedY *= decayFactor;
        if (Math.abs(speedX) < 0.01) speedX = 0;
        if (Math.abs(speedY) < 0.01) speedY = 0;
      }
      offsetX += speedX;
      offsetY += speedY;
      bg.style.backgroundPosition = offsetX + 'px ' + offsetY + 'px';
      requestAnimationFrame(animateBackground);
    }
    requestAnimationFrame(animateBackground);
    
    // Simple horizontal animation for character when not dragged
    const character = document.getElementById('character');
    let targetX = windowWidth / 2;
    let currentX = windowWidth / 2;
    let animationInterval = null;
    let isAnimating = false;
    function animateCharacter() {
      if (!dragging) {
        currentX += (targetX - currentX) * 0.1;
        character.style.left = currentX + 'px';
      }
      requestAnimationFrame(animateCharacter);
    }
    requestAnimationFrame(animateCharacter);
    
    // Variables for dragging and computing throw velocity
    let dragging = false;
    let dragOffsetX = 0, dragOffsetY = 0;
    let dragStartTime = 0, dragStartX = 0, dragStartY = 0;
    let lastDragTime = 0, lastDragX = 0, lastDragY = 0;
    
    // Mouse drag start
    characterImg.addEventListener('mousedown', function(e) {
      e.preventDefault();
      dragging = true;
      dragStartTime = Date.now();
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      lastDragTime = dragStartTime;
      lastDragX = dragStartX;
      lastDragY = dragStartY;
      const rect = characterImg.getBoundingClientRect();
      dragOffsetX = e.clientX - rect.left;
      dragOffsetY = e.clientY - rect.top;
      stopCharacterAnimation();
    });
    document.addEventListener('mousemove', function(e) {
      if (dragging) {
        e.preventDefault();
        character.style.left = (e.clientX - dragOffsetX) + 'px';
        character.style.top = (e.clientY - dragOffsetY) + 'px';
        lastDragTime = Date.now();
        lastDragX = e.clientX;
        lastDragY = e.clientY;
        lastMouseTime = Date.now();
      }
    });
    document.addEventListener('mouseup', function(e) {
      if (dragging) {
        dragging = false;
        const scale = 30; // pixels per meter
        const deltaTime = (lastDragTime - dragStartTime) / 1000;
        let initialVx = 0, initialVy = 0;
        if (deltaTime > 0.001) {
          initialVx = (lastDragX - dragStartX) / (scale * deltaTime);
          initialVy = (lastDragY - dragStartY) / (scale * deltaTime);
        } else {
          initialVy = -10;
        }
        startPhysicsSimulation({ x: initialVx, y: initialVy });
      }
    });
    
    // Touch support (similar to mouse)
    characterImg.addEventListener('touchstart', function(e) {
      e.preventDefault();
      dragging = true;
      const touch = e.touches[0];
      dragStartTime = Date.now();
      dragStartX = touch.clientX;
      dragStartY = touch.clientY;
      lastDragTime = dragStartTime;
      lastDragX = dragStartX;
      lastDragY = dragStartY;
      const rect = characterImg.getBoundingClientRect();
      dragOffsetX = touch.clientX - rect.left;
      dragOffsetY = touch.clientY - rect.top;
      stopCharacterAnimation();
    });
    document.addEventListener('touchmove', function(e) {
      if (dragging) {
        e.preventDefault();
        const touch = e.touches[0];
        character.style.left = (touch.clientX - dragOffsetX) + 'px';
        character.style.top = (touch.clientY - dragOffsetY) + 'px';
        lastDragTime = Date.now();
        lastDragX = touch.clientX;
        lastDragY = touch.clientY;
        lastMouseTime = Date.now();
      }
    }, {passive: false});
    document.addEventListener('touchend', function(e) {
      if (dragging) {
        dragging = false;
        const scale = 30;
        const deltaTime = (lastDragTime - dragStartTime) / 1000;
        let initialVx = 0, initialVy = 0;
        if (deltaTime > 0.001) {
          initialVx = (lastDragX - dragStartX) / (scale * deltaTime);
          initialVy = (lastDragY - dragStartY) / (scale * deltaTime);
        } else {
          initialVy = -10;
        }
        startPhysicsSimulation({ x: initialVx, y: initialVy });
      }
    });
    
    // Rewritten throwing simulation using Box2DWeb
    function startPhysicsSimulation(initialVelocity) {
      const scale = 30; // pixels per meter
      const rect = characterImg.getBoundingClientRect();
      
      // Create a clone for the physics simulation
      const simEl = characterImg.cloneNode(true);
      simEl.id = 'simCharacter';
      simEl.classList.add('bouncing');
      simEl.style.position = 'absolute';
      simEl.style.left = rect.left + 'px';
      simEl.style.top = rect.top + 'px';
      simEl.style.width = rect.width + 'px';
      simEl.style.height = rect.height + 'px';
      simEl.style.zIndex = '1000';
      characterImg.style.visibility = 'hidden';
      document.body.appendChild(simEl);
      
      // Box2D shortcuts
      const b2Vec2 = Box2D.Common.Math.b2Vec2;
      const b2BodyDef = Box2D.Dynamics.b2BodyDef;
      const b2Body = Box2D.Dynamics.b2Body;
      const b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
      const b2World = Box2D.Dynamics.b2World;
      const b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
      
      // Create the Box2D world with gravity (10 m/s² downward)
      const world = new b2World(new b2Vec2(0, 10), true);
      
      // Create a ground body (centered horizontally)
      let groundBodyDef = new b2BodyDef();
      groundBodyDef.position.Set(windowWidth/(2*scale), windowHeight/scale);
      let groundBody = world.CreateBody(groundBodyDef);
      let groundFixDef = new b2FixtureDef();
      groundFixDef.density = 0;
      groundFixDef.friction = 0.5;
      groundFixDef.restitution = 0.2;
      groundFixDef.shape = new b2PolygonShape();
      // Create ground as a box (half-width and a small half-height)
      groundFixDef.shape.SetAsBox(windowWidth/(2*scale), 0.1);
      groundBody.CreateFixture(groundFixDef);
      
      // Create side walls
      let leftWallDef = new b2BodyDef();
      leftWallDef.position.Set(0, windowHeight/(2*scale));
      let leftWall = world.CreateBody(leftWallDef);
      let leftWallFix = new b2FixtureDef();
      leftWallFix.shape = new b2PolygonShape();
      leftWallFix.shape.SetAsBox(0.1, windowHeight/(2*scale));
      leftWall.CreateFixture(leftWallFix);
      
      let rightWallDef = new b2BodyDef();
      rightWallDef.position.Set(windowWidth/scale, windowHeight/(2*scale));
      let rightWall = world.CreateBody(rightWallDef);
      let rightWallFix = new b2FixtureDef();
      rightWallFix.shape = new b2PolygonShape();
      rightWallFix.shape.SetAsBox(0.1, windowHeight/(2*scale));
      rightWall.CreateFixture(rightWallFix);
      
      // Create a dynamic body for the character
      let bodyDef = new b2BodyDef();
      bodyDef.type = b2Body.b2_dynamicBody;
      // Set position to the center of the image (convert to meters)
      let startX = (rect.left + rect.width/2) / scale;
      let startY = (rect.top + rect.height/2) / scale;
      bodyDef.position.Set(startX, startY);
      let body = world.CreateBody(bodyDef);
      
      let fixDef = new b2FixtureDef();
      fixDef.density = 1.0;
      fixDef.friction = 0.5;
      fixDef.restitution = 0.7;
      fixDef.shape = new b2PolygonShape();
      fixDef.shape.SetAsBox((rect.width/2)/scale, (rect.height/2)/scale);
      body.CreateFixture(fixDef);
      
      // Optionally apply a multiplier to the computed velocity if needed
      const multiplier = 1.0;
      body.SetLinearVelocity(new b2Vec2(initialVelocity.x * multiplier, initialVelocity.y * multiplier));
      
      const timeStep = 1/60;
      const velocityIterations = 8;
      const positionIterations = 3;
      
      function update() {
        world.Step(timeStep, velocityIterations, positionIterations);
        world.ClearForces();
        const pos = body.GetPosition();
        const angle = body.GetAngle();
        // Convert Box2D coordinates (meters) back to pixels
        const newLeft = (pos.x * scale) - rect.width/2;
        const newTop = (pos.y * scale) - rect.height/2;
        simEl.style.left = newLeft + 'px';
        simEl.style.top = newTop + 'px';
        simEl.style.transform = "rotate(" + (angle * 180/Math.PI) + "deg)";
        
        const velocity = body.GetLinearVelocity();
        // When velocity is very low and the object is near the ground, finish the simulation
        if (velocity.Length() < 0.1 && (newTop + rect.height >= windowHeight - 5)) {
          simEl.style.top = (windowHeight - rect.height) + 'px';
          document.body.removeChild(simEl);
          characterImg.style.visibility = 'visible';
          character.style.left = simEl.style.left;
          character.style.top = simEl.style.top;
          return;
        }
        requestAnimationFrame(update);
      }
      requestAnimationFrame(update);
    }
    
    // Standard animation for changing the character image when not dragging
    function startCharacterAnimation() {
      if (dragging) return;
      isAnimating = true;
      let toggle = false;
      animationInterval = setInterval(() => {
        toggle = !toggle;
        characterImg.src = toggle ? '3.png' : '4.png';
        if (Date.now() - lastMouseTime > 200) {
          stopCharacterAnimation();
        }
      }, 70);
    }
    
    function stopCharacterAnimation() {
      clearInterval(animationInterval);
      animationInterval = null;
      isAnimating = false;
      characterImg.src = '2.png';
    }
    
    // Global listeners for mouse/touch movement (update background and character target)
    document.addEventListener('mousemove', function(e) {
      const mouseX = e.clientX;
      const mouseY = e.clientY;
      const deltaX = (mouseX - windowWidth / 2) / (windowWidth / 2);
      const deltaY = (mouseY - windowHeight / 2) / (windowHeight / 2);
      const maxSpeed = 20;
      speedX = deltaX * maxSpeed;
      speedY = deltaY * maxSpeed;
      targetX = mouseX;
      lastMouseTime = Date.now();
      if (!isAnimating && !dragging) {
        startCharacterAnimation();
      }
    });
    document.addEventListener('touchmove', function(e) {
      if (!dragging) {
        const touch = e.touches[0];
        targetX = touch.clientX;
        lastMouseTime = Date.now();
        if (!isAnimating) {
          startCharacterAnimation();
        }
      }
    }, {passive: false});
    
    // Hover overlay functionality for navigation buttons (unchanged)
    const hoverImageDiv = document.getElementById('hoverImage');
    function showHoverImage(imageUrl) {
      hoverImageDiv.style.backgroundImage = "url('" + imageUrl + "')";
      hoverImageDiv.style.display = "block";
    }
    function hideHoverImage() {
      hoverImageDiv.style.display = "none";
    }
    document.getElementById('maks-button').addEventListener('mouseenter', function() {
      hoverImageDiv.style.backgroundSize = "contain";
      showHoverImage('maksrz.png');
    });
    document.getElementById('maks-button').addEventListener('mouseleave', hideHoverImage);
    document.getElementById('video-button').addEventListener('mouseenter', function() {
      hoverImageDiv.style.backgroundSize = "60% auto";
      showHoverImage('gifaniol.gif');
    });
    document.getElementById('video-button').addEventListener('mouseleave', function() {
      hideHoverImage();
      hoverImageDiv.style.backgroundSize = "contain";
    });
    document.getElementById('art-button').addEventListener('mouseenter', function() {
      hoverImageDiv.style.backgroundSize = "50% auto";
      showHoverImage('art.png');
    });
    document.getElementById('art-button').addEventListener('mouseleave', function() {
      hideHoverImage();
      hoverImageDiv.style.backgroundSize = "contain";
    });
    document.getElementById('contact-button').addEventListener('mouseenter', function() {
      hoverImageDiv.style.backgroundSize = "contain";
      showHoverImage('contact.png');
    });
    document.getElementById('contact-button').addEventListener('mouseleave', hideHoverImage);
    document.getElementById('enemies-button').addEventListener('mouseenter', function() {
      hoverImageDiv.style.backgroundSize = "contain";
      showHoverImage('enemies.png');
    });
    document.getElementById('enemies-button').addEventListener('mouseleave', hideHoverImage);
    document.getElementById('awards-button').addEventListener('mouseenter', function() {
      hoverImageDiv.style.backgroundSize = "contain";
      showHoverImage('awards.png');
    });
    document.getElementById('awards-button').addEventListener('mouseleave', hideHoverImage);
    
    // Set a random visitor name
    const names = [
      "Aldous", "Basil", "Crispin", "Lysander", "Octavian", "Percival", "Quentin", "Reginald", "Thaddeus", "Ulysses", "Vesper", "Winston", "Xavier", "Yorick", "Zacharias",
      "Adelaide", "Beatrice", "Cordelia", "Delphine", "Evangeline", "Felicity", "Gwendolyn", "Harriet", "Isolde", "Jacqueline", "Katrina", "Lucinda", "Mirabelle", "Nerissa", "Ophelia",
      "Błażej", "Mieczysław", "Zbigniew", "Witold", "Bronisław", "Czesław", "Lech", "Stanisław", "Wacław", "Kazimierz",
      "Agnieszka", "Barbara", "Czesława", "Danuta", "Elżbieta", "Grażyna", "Halina", "Irena", "Jadwiga", "Krystyna", "Łucja", "Małgorzata", "Natalia", "Olga", "Patrycja",
      "Seraphina", "Isadora", "Eulalia", "Octavia", "Guinevere", "Rowena", "Imogen", "Selene", "Theodora", "Valentina", "Opalina", "Marigold", "Rosalind", "Cordula"
    ];
    const randomName = names[Math.floor(Math.random() * names.length)];
    document.getElementById("visitorName").innerText = "potential visitor name: " + randomName;
  </script>
</body>
</html>
